<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>WebSocket Test</title>
    <link rel='shortcut icon' href='/favicon.ico'>
    <script src='/js/script.js'></script>
    <!--<link rel='stylesheet' href='https://www.w3schools.com/w3css/5/w3.css'>-->
    <link rel='stylesheet' href='/css/style.css'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</head>
<body class='w3-container w3-asphalt'>
    <h1>WebSocket Test</h1>

    <div class="sollwerte">
        <label>Stunde</label>
        <input data-name='A01_DB10_DBW2' data-unit='std' disabled>
        <input type="number" min="0" max="23" data-unit='std' data-name='A01_DB10_DBW2'>

        <label>Minute</label>
        <input data-name='A01_DB10_DBW4' data-unit='min' disabled>
        <input type="number" min="0" max="60" data-unit='min' data-name='A01_DB10_DBW4'>

        <label>Sekunde</label>
        <input data-name='A01_DB10_DBW6' data-unit='s' disabled>
        <input type="number" min="0" max="60" data-unit='sec' data-name='A01_DB10_DBW6'>

        <label>Raumtemperatur</label>
        <div>&nbsp;</div>
        <div>&nbsp;</div>
        <input value="-10" type="number" min="-40" max="0" step="0.1" data-unit='°C'>

    </div>

    <canvas id="myChart" style="margin:2rem;background-color:white;max-width:70vw"></canvas>

    <script>
        let xValues = [];
        let yValues1 = [];
        let yValues2 = [];
        let yValues3 = [];

        var lineChart = new Chart("myChart", {
            type: "line",
            data: {
                labels: xValues,
                datasets: [{
                    label: "A01_DB10_DBW6",
                    fill: false,
                    borderColor: 'red',
                    backgroundColor: '#991122',
                    tension: 0,
                    data: yValues1
                }, {
                    label: "A01_DB10_DBW4",
                    fill: false,
                    borderColor: 'green',
                    backgroundColor: '#119922',
                    data: yValues2
                }, {
                    label: "A01_DB10_DBW2",
                    fill: false,
                    borderColor: 'blue',
                    backgroundColor: '#112299',
                    data: yValues3
                }]
            },
            options: {
                legend: { display: 'bottom' },
                scales: {
                    yAxes: [{ ticks: { min: 0, max: 70 } }],
                }
            }
        });

        function addData3(arr) {

            let time = new Date();
            time = time.toLocaleString();
            lineChart.data.labels.push(time);
            lineChart.data.datasets.forEach((dataset) => {
                let pos = arr.findIndex(x => x.N == dataset.label);
                if (pos >= 0)
                    dataset.data.push(arr[pos].V);
                else {
                    //let oldVal = null;
                    let oldVal = dataset.data.findLast(x => x != null);
                    dataset.data.push(oldVal);
                }
            });

            lineChart.update('none');
        }

        function addData2(time, tagname, value) {
            time = time.toLocaleString();
            let pos = lineChart.data.datasets.findIndex(x => x.label == tagname);
            const item = { x: time, y: value };

            lineChart.data.labels.push(time);
            lineChart.data.datasets[pos].data.push(item);
            lineChart.update('none');
        }

        function removeData(chart) {
            chart.data.labels.pop();
            chart.data.datasets.forEach((dataset) => {
                dataset.data.pop();
            });
            chart.update('none'); //ohne Animation
        }

    </script>
</body>
</html >